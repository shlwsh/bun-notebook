# 增强编辑器功能需求

## 概述
扩展当前 Markdown 编辑器，支持 TypeScript 和 TXT 文件的编辑，并为 Markdown 文件添加富文本编辑工具栏。

## 用户故事

### 1. TypeScript 文件支持
**作为** 开发者  
**我想要** 在编辑器中打开和编辑 TypeScript 文件  
**以便** 我可以在同一个应用中查看和修改代码文件

**验收标准：**
- [ ] 1.1 可以在文件树中看到 `.ts` 和 `.tsx` 文件
- [ ] 1.2 点击 TS 文件可以在编辑器中打开
- [ ] 1.3 TS 代码有语法高亮显示
- [ ] 1.4 支持 TypeScript 语法的智能提示
- [ ] 1.5 可以编辑并保存 TS 文件
- [ ] 1.6 编辑器支持代码折叠
- [ ] 1.7 显示行号和当前行高亮

### 2. TXT 文件支持
**作为** 用户  
**我想要** 编辑纯文本文件  
**以便** 我可以处理各种文本内容

**验收标准：**
- [ ] 2.1 可以在文件树中看到 `.txt` 文件
- [ ] 2.2 点击 TXT 文件可以在编辑器中打开
- [ ] 2.3 可以编辑并保存 TXT 文件
- [ ] 2.4 支持基本的文本编辑功能（复制、粘贴、撤销、重做）
- [ ] 2.5 显示行号

### 3. Markdown 富文本工具栏
**作为** 文档编写者  
**我想要** 使用可视化工具栏来格式化 Markdown 内容  
**以便** 我可以更方便地编辑文档而不需要记住所有 Markdown 语法

**验收标准：**
- [ ] 3.1 在 Markdown 编辑模式下显示格式化工具栏
- [ ] 3.2 工具栏包含字体大小调整按钮（H1-H6）
- [ ] 3.3 工具栏包含文本样式按钮（粗体、斜体、删除线）
- [ ] 3.4 工具栏包含列表按钮（有序列表、无序列表）
- [ ] 3.5 工具栏包含插入表格按钮
- [ ] 3.6 工具栏包含插入图片按钮
- [ ] 3.7 工具栏包含插入链接按钮
- [ ] 3.8 工具栏包含插入代码块按钮
- [ ] 3.9 工具栏包含引用块按钮
- [ ] 3.10 点击工具栏按钮可以在光标位置插入相应的 Markdown 语法
- [ ] 3.11 选中文本后点击格式按钮可以包裹选中内容

### 4. 文件树过滤优化
**作为** 用户  
**我想要** 在文件树中看到所有支持的文件类型  
**以便** 我可以快速找到需要编辑的文件

**验收标准：**
- [ ] 4.1 文件树默认显示 `.md`、`.ts`、`.tsx`、`.txt` 文件
- [ ] 4.2 文件树显示文件夹（即使不包含 MD 文件）
- [ ] 4.3 不同文件类型有不同的图标
- [ ] 4.4 可以通过过滤器切换显示的文件类型
- [ ] 4.5 文件树性能良好，即使有大量文件

### 5. 编辑器模式切换
**作为** 用户  
**我想要** 根据文件类型自动切换编辑器模式  
**以便** 获得最佳的编辑体验

**验收标准：**
- [ ] 5.1 打开 MD 文件时显示预览/编辑切换按钮
- [ ] 5.2 打开 TS/TXT 文件时只显示编辑模式
- [ ] 5.3 MD 文件的工具栏只在编辑模式下显示
- [ ] 5.4 不同文件类型的编辑器配置正确（语法高亮、自动补全等）

## 技术要求

### 前端
- 使用 CodeMirror 6 作为编辑器核心
- TypeScript 语法支持使用 `@codemirror/lang-javascript`
- 工具栏使用 Vue 3 组件实现
- 图标使用 lucide-vue-next

### 后端
- 无需修改 Rust 后端，现有的文件读写 API 已足够

### 性能
- 大文件（>1MB）加载时间 < 1秒
- 编辑器响应时间 < 100ms
- 文件树渲染时间 < 500ms

## 非功能性需求

### 可用性
- 工具栏按钮有清晰的图标和提示文本
- 快捷键与常见编辑器保持一致
- 错误提示友好且有帮助

### 兼容性
- 支持 Windows、macOS、Linux
- 支持深色和浅色主题

### 可维护性
- 代码模块化，易于扩展新的文件类型
- 工具栏组件可复用

## 实现优先级

### P0 (必须实现)
1. TypeScript 文件基本编辑和语法高亮
2. TXT 文件基本编辑
3. 文件树显示所有支持的文件类型

### P1 (重要)
4. Markdown 工具栏基本功能（标题、粗体、斜体、列表）
5. 插入表格功能
6. 插入图片功能

### P2 (可选)
7. 高级格式化功能（引用、代码块、链接）
8. 代码折叠
9. 文件类型过滤器

## 测试计划

### 单元测试
- 工具栏按钮点击事件
- Markdown 语法插入逻辑
- 文件类型识别

### 集成测试
- 打开不同类型文件
- 编辑并保存文件
- 工具栏与编辑器交互

### 用户测试
- 编辑 TypeScript 文件的流畅度
- 工具栏的易用性
- 整体性能表现

## 风险与挑战

1. **性能风险**：大型 TS 文件可能导致编辑器卡顿
   - 缓解措施：使用虚拟滚动，延迟加载语法高亮

2. **兼容性风险**：不同操作系统的快捷键差异
   - 缓解措施：使用 CodeMirror 的跨平台快捷键配置

3. **用户体验风险**：工具栏可能占用过多空间
   - 缓解措施：设计紧凑的工具栏，支持折叠

## 成功指标

- 用户可以成功编辑 TS 和 TXT 文件
- Markdown 工具栏使用率 > 50%
- 编辑器性能满足技术要求
- 用户反馈积极（如果有反馈渠道）

## 后续迭代

- 支持更多编程语言（JS、Python、Rust 等）
- 代码片段功能
- 多光标编辑
- 查找和替换功能
- Git 集成显示文件变更状态
