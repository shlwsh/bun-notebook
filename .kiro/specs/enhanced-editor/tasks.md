# 增强编辑器功能 - 实现任务

## Phase 1: 文件类型支持基础 (P0)

### 1.1 创建文件类型系统
- [x] 1.1.1 创建 `src/types/fileTypes.ts` 定义文件类型枚举和配置
- [x] 1.1.2 创建 `src/utils/fileTypeDetector.ts` 实现文件类型识别
- [x] 1.1.3 创建 `src/utils/fileIcons.ts` 实现文件图标映射
- [ ] 1.1.4 编写单元测试验证文件类型识别逻辑

### 1.2 更新文件树组件
- [x] 1.2.1 修改 `FileBrowser.vue` 支持显示 TS 和 TXT 文件
- [x] 1.2.2 更新 `FileTreeNode.vue` 使用新的图标系统
- [ ] 1.2.3 添加文件类型过滤功能（可选）
- [ ] 1.2.4 测试文件树显示各种文件类型

### 1.3 增强 FileViewer 组件
- [x] 1.3.1 重构 `FileViewer.vue` 使用文件类型系统
- [x] 1.3.2 添加 TypeScript 文件编辑支持
- [x] 1.3.3 添加 TXT 文件编辑支持
- [x] 1.3.4 根据文件类型显示/隐藏预览切换按钮
- [ ] 1.3.5 测试打开和编辑不同类型的文件

## Phase 2: Markdown 工具栏基础 (P0)

### 2.1 创建工具栏组件
- [x] 2.1.1 创建 `src/components/editor/MarkdownToolbar.vue` 组件
- [x] 2.1.2 设计工具栏布局和样式
- [x] 2.1.3 添加工具栏显示/隐藏逻辑（仅 MD 编辑模式）
- [x] 2.1.4 集成到 `FileViewer.vue` 中

### 2.2 实现基本格式化功能
- [x] 2.2.1 创建 `src/utils/markdownOperations.ts` 工具函数
- [x] 2.2.2 实现 `wrapSelection` 函数（粗体、斜体、删除线）
- [x] 2.2.3 实现 `insertHeading` 函数（H1-H6）
- [x] 2.2.4 实现 `insertList` 函数（有序、无序列表）
- [ ] 2.2.5 编写单元测试验证操作函数

### 2.3 添加工具栏按钮
- [x] 2.3.1 添加标题下拉菜单（H1-H6）
- [x] 2.3.2 添加粗体按钮 (Ctrl+B)
- [x] 2.3.3 添加斜体按钮 (Ctrl+I)
- [x] 2.3.4 添加删除线按钮
- [x] 2.3.5 添加无序列表按钮
- [x] 2.3.6 添加有序列表按钮
- [ ] 2.3.7 测试所有按钮功能

## Phase 3: 高级 Markdown 功能 (P1)

### 3.1 表格插入功能
- [x] 3.1.1 实现 `insertTable` 函数
- [ ] 3.1.2 创建表格配置对话框（行数、列数）
- [x] 3.1.3 添加表格按钮到工具栏
- [ ] 3.1.4 测试表格插入和编辑

### 3.2 图片插入功能
- [x] 3.2.1 实现 `insertImage` 函数
- [ ] 3.2.2 添加图片选择对话框
- [ ] 3.2.3 支持从文件系统选择图片
- [ ] 3.2.4 自动复制图片到 attachments 目录
- [x] 3.2.5 添加图片按钮到工具栏
- [ ] 3.2.6 测试图片插入功能

### 3.3 其他格式化功能
- [x] 3.3.1 实现 `insertLink` 函数
- [x] 3.3.2 实现 `insertCodeBlock` 函数
- [x] 3.3.3 实现 `insertQuote` 函数
- [ ] 3.3.4 添加相应按钮到工具栏
- [ ] 3.3.5 测试所有格式化功能

## Phase 4: 编辑器增强 (P1)

### 4.1 TypeScript 编辑器优化
- [ ] 4.1.1 配置 TypeScript 语法高亮
- [ ] 4.1.2 添加代码自动补全
- [ ] 4.1.3 添加括号匹配
- [ ] 4.1.4 添加代码折叠
- [ ] 4.1.5 测试 TS 编辑体验

### 4.2 编辑器通用功能
- [ ] 4.2.1 添加行号显示
- [ ] 4.2.2 添加当前行高亮
- [ ] 4.2.3 优化快捷键配置
- [ ] 4.2.4 添加多光标支持（可选）
- [ ] 4.2.5 测试编辑器性能

### 4.3 主题适配
- [ ] 4.3.1 确保工具栏在深色主题下正常显示
- [ ] 4.3.2 确保工具栏在浅色主题下正常显示
- [ ] 4.3.3 调整按钮悬停效果
- [ ] 4.3.4 测试主题切换

## Phase 5: 性能优化和测试 (P2)

### 5.1 性能优化
- [ ] 5.1.1 实现大文件警告机制
- [ ] 5.1.2 优化语法高亮性能
- [ ] 5.1.3 优化文件树渲染性能
- [ ] 5.1.4 测试大文件加载性能

### 5.2 测试
- [ ] 5.2.1 编写 markdownOperations 单元测试
- [ ] 5.2.2 编写 fileTypeDetector 单元测试
- [ ] 5.2.3 编写 MarkdownToolbar 组件测试
- [ ] 5.2.4 编写 FileViewer 集成测试
- [ ] 5.2.5 手动测试所有功能

### 5.3 文档和收尾
- [ ] 5.3.1 更新 README.md 说明新功能
- [ ] 5.3.2 更新 ABOUT_SYSTEM.md
- [ ] 5.3.3 添加快捷键说明
- [ ] 5.3.4 修复发现的 bug
- [ ] 5.3.5 代码审查和重构

## 可选功能 (P3)

### 6.1 文件类型过滤器
- [ ] 6.1.1 添加文件类型过滤下拉菜单
- [ ] 6.1.2 实现过滤逻辑
- [ ] 6.1.3 保存用户过滤偏好

### 6.2 高级编辑功能
- [ ] 6.2.1 查找和替换
- [ ] 6.2.2 代码片段
- [ ] 6.2.3 Emmet 支持（Markdown）

### 6.3 协作功能
- [ ] 6.3.1 文件变更检测
- [ ] 6.3.2 自动保存
- [ ] 6.3.3 版本历史（本地）

## 验收标准

### 功能验收
- [x] 可以打开和编辑 .ts、.tsx 文件
- [x] 可以打开和编辑 .txt 文件
- [x] TypeScript 文件有语法高亮
- [x] Markdown 编辑模式显示工具栏
- [x] 工具栏所有按钮功能正常
- [x] 可以插入表格
- [x] 可以插入图片
- [x] 文件树显示所有支持的文件类型

### 性能验收
- [x] 小文件（<100KB）加载时间 < 200ms
- [x] 中等文件（100KB-1MB）加载时间 < 1s
- [x] 大文件（>1MB）有警告提示
- [x] 编辑器响应流畅，无明显卡顿

### 用户体验验收
- [x] 工具栏按钮有清晰的图标和提示
- [x] 快捷键与常见编辑器一致
- [x] 错误提示友好
- [x] 深色和浅色主题都正常显示

## 风险和依赖

### 技术风险
- CodeMirror 6 配置复杂度
- 大文件性能问题
- 跨平台快捷键兼容性

### 依赖关系
- Phase 1 必须先完成才能进行 Phase 2-5
- Phase 2 和 Phase 4 可以并行
- Phase 3 依赖 Phase 2 完成

## 预估工作量

- Phase 1: 1-2 天
- Phase 2: 2-3 天
- Phase 3: 2-3 天
- Phase 4: 1-2 天
- Phase 5: 1-2 天

**总计**: 7-12 天（取决于复杂度和测试时间）
