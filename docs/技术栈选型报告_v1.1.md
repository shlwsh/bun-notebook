# 技术栈选型说明报告
版本：v1.1

## 1. 总体架构：Client-Server (C/S)
本系统采用轻量级 C/S 架构，后端作为本地服务运行，前端作为可视化交互界面。

---

## 2. 后端技术栈 (信创兼容版)

### **Runtime: Node.js (LTS 20+)**
*   **选型依据**:
    1.  **信创兼容性 (关键)**: Node.js 拥有最广泛的架构支持，完美适配国产芯片（鲲鹏/飞腾 ARM64、海光/兆芯 x86_64，甚至是龙芯 LoongArch）。相比之下，Bun 在非主流架构上的支持尚不成熟。
    2.  **跨平台稳定性**: 在 Windows, Linux (统信/麒麟), macOS 上均有经过十年验证的生产级稳定性。
    3.  **生态标准**: 它是企业级应用的事实标准，合规风险最低。

### **Web Framework: Fastify**
*   **选型依据**:
    1.  **高性能**: Node.js 生态中性能第一梯队的框架，吞吐量远超 Express，接近系统上限。
    2.  **插件生态**: 拥有丰富的插件体系，方便集成 Swagger 文档、CORS、WebSocket 等。
    3.  **低开销**: 极低的启动开销和内存占用，符合“轻量化”要求。

### **核心解析引擎: Tree-sitter (Node Bindings)**
*   **选型依据**:
    1.  **多语言支持**: 统一支持 Java, C/C++, Go, Python, JS 等，是代码分析领域的通用标准。
    2.  **WASM/NAPI**: 提供预编译的 N-API 绑定，确保在不同 OS/CPU 架构下都能稳定运行，无需本地编译环境。

### **版本控制集成: Simple-git**
*   **选型依据**:
    1.  **API 完整**: 提供了对 Git 命令的完整封装，能够轻松读取 Commit 历史、Diff 信息和文件变更。
    2.  **轻量稳定**: 社区广泛使用，成熟度高。

---

## 3. 前端技术栈

### **Frontend Framework: React 18 + Vite**
*   **选型依据**:
    1.  **生态繁荣**: 拥有最丰富的可视化库和 UI 组件库资源。
    2.  **Vite**: 构建速度极快，是目前前端工程化的首选。

### **可视化引擎: React Flow (或 XYFlow)**
*   **选型依据**:
    1.  **流程图专家**: 专为基于节点的图（Node-based Graph）设计，非常适合展示架构图、依赖图和调用链。
    2.  **交互性强**:  内置缩放、平移、拖拽等交互功能。

### **状态管理: Zustand**
*   **选型依据**:
    1.  **极简主义**: 相比 Redux 更加轻量，API 简单直观。
    2.  **非侵入式**: 能够很好地处理复杂的前端状态。

---

## 4. 数据存储

### **图数据库: Graphology (内存) + SQLite (Better-SQLite3)**
*   **选型依据**:
    1.  **Graphology**: 纯 JS 实现的图算法库，无原生依赖，随处运行 (Run Anywhere)。
    2.  **SQLite (Better-SQLite3)**: 
        *   **单文件数据库**: 零配置，无需安装 MySQL/PG 等重型服务。
        *   **源码编译**: `better-sqlite3` 可以在安装时自动编译（或使用预编译二进制），适配各种国产 Linux 环境。

---

## 5. 信创与轻量化部署方案

### **5.1 跨平台打包 (Pkg / Single Executable)**
*   **技术**: 使用 `pkg` 或 Node.js 21+ 的 SEA (Single Executable Applications) 功能。
*   **效果**: 
    *   将 Node.js 运行时、后端代码、依赖库打包成**一个独立的可执行文件** (exe/elf)。
    *   用户无需安装 Node.js 环境，下载即运行。
    *   **体积**: 压缩后约 40MB - 60MB，极度轻量。

### **5.2 信创环境支持**
*   **操作系统**: 统信 UOS, 麒麟 Kylin, 中科方德。
*   **CPU架构**: 
    *   **ARM64**: 鲲鹏 920, 飞腾 FT-2000 (Node.js 官方支持)。
    *   **x86_64**: 海光, 兆芯 (完全兼容)。
    *   **MIPS64 / LoongArch**: 龙芯 (Node.js 社区构建版支持)。

---

## 6. 总结
本次选型调整以 **"兼容性、合规性、稳定性"** 为首要目标。
*   弃用 Bun，回归 **Node.js + Fastify**，确保在国产信创环境下的绝对可用性。
*   采用 **Single Executable** 打包技术，满足“轻量化部署”的核心诉求。
*   整体架构依然保持轻量高效，兼顾了性能与政策风险。
