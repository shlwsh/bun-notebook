# 源码分析与AI开发管控系统 - 产品需求规格说明书 (PRD)

## 文档版本信息

| 版本 | 日期 | 作者 | 变更说明 |
|------|------|------|----------|
| v1.2 | 2026-01-11 | 产品团队 | 调整实时性要求，强化核心分析与Git追溯功能 |
| v1.1 | 2026-01-11 | 产品团队 | 适配AI Vibe Coding场景，增加风险管控需求 |
| v1.0 | 2026-01-11 | 产品团队 | 初始版本 |

---

## 一、产品概述

### 1.1 背景与痛点

随着AI编程（Vibe Coding）的兴起，软件开发模式正在发生根本性变革。开发者通过自然语言与AI交互，由AI快速生成和修改代码。这种模式带来了极致的开发效率，但也引入了新的挑战：
1.  **黑盒风险**：AI生成的代码逻辑复杂，人类开发者难以完全掌握其内部实现细节和架构合理性。
2.  **管理难题**：高频的代码变更可能迅速积累技术债务，缺乏有效的宏观管控手段。
3.  **认知负荷**：在快速迭代中，了解系统全貌、模块关系以及变更影响范围变得更加困难。

### 1.2 产品定位

本系统定位为 **"源码全景分析与AI开发治理平台"**。
系统核心在于通过静态代码分析、可视化展示和Git版本追踪，帮助用户**看清**代码结构，**理清**模块关系，**查清**变更影响。它不追求毫秒级的直播式监控，而致力于提供准确、深度、可回溯的系统分析能力，确保在AI辅助开发的过程中，项目架构依然清晰可控。

### 1.3 核心价值

- **深度洞察 (Insight)**: 清晰展示系统、模块、类、方法之间的复杂关系。
- **变更追溯 (Traceability)**: 基于Git历史，可视化追溯历次变更的范围与影响。
- **风险管控 (Governance)**: 识别架构腐化、循环依赖和API破坏性变更。
- **知识沉淀 (Knowledge)**: 将代码逻辑转化为可视化的团队知识库。

---

## 二、核心功能模块

### 2.1 代码全景与治理看板 (Overview & Governance)

**功能描述**: 提供项目整体健康度和架构状态的宏观视图。

1.  **架构全景图**:
    *   展示系统模块划分及依赖关系。
    *   支持分层下钻：系统 -> 模块 -> 类 -> 方法。
    *   颜色编码：区分稳定模块、高频变更模块和AI新生成模块。

2.  **项目健康度指标**:
    *   代码复杂度趋势。
    *   模块耦合度分析。
    *   注释覆盖率与文档完整性。

3.  **治理报告**:
    *   定期（或按需）生成的系统体检报告，指出架构风险点。

### 2.2 深度结构分析与可视化 (Deep Analysis)

**功能描述**: 将代码文本转化为多维度的可视化图表，辅助阅读与理解。

1.  **多维关系视图**:
    *   **依赖图**: 精确展示模块/类之间的`Import/Use`关系，一键识别循环依赖。
    *   **调用链**: 跨文件的方法调用追踪，通过静态分析串联业务逻辑链路。
    *   **继承/实现树**: 清晰展示类的继承体系和接口实现关系。

2.  **智能代码导航**:
    *   符号跳转：点击图谱节点，直接跳转到源码位置。
    *   引用查找：反向查询"谁调用了这个核心方法"。

### 2.3 Git 变更追溯与影响分析 (Git Integration)

**功能描述**: 结合Git历史，不仅看"现在"，更能看"过去"和"变化"。

1.  **变更影响范围 (Impact Analysis)**:
    *   输入：一次Commit或一个Feature分支。
    *   输出：除直接修改文件外，自动计算受波及的依赖模块和调用链。
    *   价值：AI修改了一处底层逻辑，系统自动提示上层哪些业务可能崩溃。

2.  **演进历史回溯**:
    *   **时光轴**: 拖动时间轴，查看系统架构并未随时间的变化过程。
    *   **作者热力图**: 区分哪些代码是"AI"生成的（基于提交特征或注释），哪些是人工编写的。

3.  **Diff 可视化**:
    *   提供基于语义的变更对比，不仅仅是行级Diff，而是"结构级Diff"（如：新增了方法A，删除了属性B）。

### 2.4 AI 辅助编程治理 (AI Governance)

1.  **风险规则检测**:
    *   架构规范检查：如禁止Controller层直接调用DAO层。
    *   API兼容性分析：检测Public API的签名变更。

2.  **意图-代码关联**:
    *   尝试解析AI生成的Commit Message或PR描述，将其与代码变更区域关联，帮助理解"为什么改这里"。

---

## 三、用户使用流程 (Workflow)

### 3.1 场景：代码变更评审 (Code Review)

1.  **变更提交**: 开发者或AI提交代码（Pull Request）。
2.  **自动分析**: CI流水线或本地IDE插件触发Deep Analysis。
    *   系统识别变更文件，计算依赖波及范围。
    *   系统检查架构约束（如层级调用规范）。
3.  **可视化辅助**: Reviewer查看"变更影响图"，发现不仅仅改了A文件，还导致C模块的接口调用失效。
4.  **决策**: 基于精准的分析报告，快速决定通过或驳回。

### 3.2 场景：新项目架构梳理

1.  **导入项目**: 指定Git仓库地址。
2.  **构建全景**: 系统全量解析代码，生成架构全景图。
3.  **探索学习**: 用户通过可视化图表，从宏观模块到微观方法，逐层理解系统逻辑。

---

## 四、技术架构要求

### 4.1 核心指标

*   **响应速度**: 分析任务触发后，中型项目（~10万行）分析耗时 < 5秒。
*   **准确性**: 静态分析能够准确识别95%以上的显式依赖关系。
*   **兼容性**: 支持IDE内嵌网页或独立Web部署。

### 4.2 架构分层

1.  **采集层 (Watcher Agent)**:
    *   File Watcher (chokidar/notify)
    *   LSP Client (利用现有语言服务器能力)
2.  **分析层 (Analysis Engine)**:
    *   增量构建依赖图 (Dependency Graph)
    *   风险规则引擎 (Rule Engine)
3.  **数据层 (Knowledge Graph)**:
    *   存储代码实体及其关系 (Graph DB / In-memory Graph)
    *   存储变更历史 (Git + Snapshots)
4.  **展示层 (Visualizer)**:
    *   Web Based UI (React + WebGL/Canvas)
    *   IDE Extension (WebView)

---

## 五、实施路线图 (调整版)

### Phase 1: 核心基础 (Insight)
*   **目标**: 建立代码解析与可视化基础。
*   **交付**: 静态代码解析器、架构关系图、基础的Git提交记录展示。

### Phase 2: 变更与治理 (Governance)
*   **目标**: 实现变更加的深度分析与管控。
*   **交付**: Git变更影响分析、架构规则检查、Diff增强视图。

### Phase 3: 智能演进 (Evolution)
*   **目标**: 结合AI增强分析能力。
*   **交付**: 业务逻辑自动推导、自然语言查询代码库。

