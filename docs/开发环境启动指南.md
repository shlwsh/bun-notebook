# 开发环境启动指南

## 快速开始

### 主要开发命令（推荐）

```bash
bun run dev
```

这将启动完整的 Tauri 开发环境，包括：
- ✅ 自动启动 Vite 开发服务器（端口 1420）
- ✅ 自动启动 Tauri 桌面应用
- ✅ 支持热重载（Hot Module Replacement）
- ✅ 自动打开应用窗口

## 所有可用命令

### 开发相关

| 命令 | 说明 | 使用场景 |
|------|------|----------|
| `bun run dev` | 启动完整的 Tauri 开发环境 | **日常开发（推荐）** |
| `bun run vite:dev` | 仅启动 Vite 开发服务器 | 仅需要前端开发，不需要桌面应用 |
| `bun run tauri:dev` | 使用自定义脚本启动 | 需要自定义端口或其他配置 |

### 构建和测试

| 命令 | 说明 |
|------|------|
| `bun run build` | 构建生产版本 |
| `bun run tauri:build` | 构建 Tauri 桌面应用 |
| `bun run test` | 运行单元测试 |
| `bun run lint` | 代码检查 |

### 工具脚本

| 命令 | 说明 |
|------|------|
| `bun run mygit` | Git 提交辅助工具 |
| `bun run upgrade` | 版本升级工具 |
| `bun run mytag` | Git 标签管理工具 |

## 工作原理

### bun run dev 的执行流程

```
1. 执行 package.json 中的 "dev": "bun tauri dev"
   ↓
2. Tauri CLI 读取 src-tauri/tauri.conf.json
   ↓
3. 执行 beforeDevCommand: "bun run vite:dev"
   ↓
4. Vite 开发服务器在 http://localhost:1420 启动
   ↓
5. Tauri 检测到服务器就绪
   ↓
6. 启动桌面应用窗口并加载前端页面
   ↓
7. 开发环境就绪，支持热重载
```

## 端口配置

默认端口：**1420**

### 修改端口

1. 编辑 `.env` 文件：
```env
VITE_PORT=3000
```

2. 编辑 `src-tauri/tauri.conf.json`：
```json
{
  "build": {
    "devUrl": "http://localhost:3000"
  }
}
```

3. 或使用自定义脚本：
```bash
./scripts/dev.sh 3000
```

## 常见问题

### 1. 端口被占用

**错误信息：**
```
Port 1420 is already in use
```

**解决方案：**
```bash
# macOS/Linux
lsof -ti:1420 | xargs kill -9

# 或修改端口（见上方"端口配置"）
```

### 2. Vite 服务器启动失败

**错误信息：**
```
Waiting for your frontend dev server to start on http://localhost:1420/
```

**解决方案：**
1. 检查 Node.js/Bun 是否正确安装
2. 检查依赖是否完整安装：`bun install`
3. 检查端口是否被占用
4. 查看 Vite 错误日志

### 3. Tauri 窗口无法打开

**解决方案：**
1. 确认 Rust 环境已安装：`rustc --version`
2. 确认 Tauri CLI 已安装：`bun tauri --version`
3. 重新安装依赖：`rm -rf node_modules && bun install`

## 开发建议

### 推荐工作流

1. **启动开发环境**
   ```bash
   bun run dev
   ```

2. **编辑代码**
   - 前端代码：`src/` 目录
   - 后端代码：`src-tauri/src/` 目录

3. **查看效果**
   - 前端修改会自动热重载
   - 后端修改需要重启（Ctrl+C 后重新运行）

4. **运行测试**
   ```bash
   bun run test
   ```

5. **代码检查**
   ```bash
   bun run lint
   ```

### 性能优化建议

- 使用 `bun run dev` 而不是 `npm run dev`（Bun 更快）
- 开发时关闭不必要的浏览器扩展
- 使用 SSD 存储项目文件
- 确保有足够的内存（建议 8GB+）

## 技术栈

- **前端**：Vue 3 + TypeScript + Vite + Tailwind CSS
- **后端**：Rust + Tauri 2.0
- **包管理器**：Bun
- **测试**：Vitest

## 相关文档

- [技术栈规范](../.kiro/steering/02-tech-stack.md)
- [测试要求规范](../.kiro/steering/03-testing-requirements.md)
- [验收标准规范](../.kiro/steering/04-acceptance-criteria.md)
