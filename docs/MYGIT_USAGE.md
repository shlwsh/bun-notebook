# MyGit 使用说明

## 简介

`mygit` 是一个智能 Git 提交工具，支持使用 AI 自动生成提交信息。

## 功能特性

- ✅ 自动检测文件变更
- ✅ AI 智能生成提交信息
- ✅ 自动设置上游分支
- ✅ 一键完成 add、commit、push 流程
- ✅ 支持手动指定提交信息
- ✅ 兜底机制：AI 失败时自动使用文件名生成

## 快速开始

### 1. 配置环境变量

复制 `.env.example` 到 `.env`：

```bash
cp .env.example .env
```

编辑 `.env` 文件，填入你的 DashScope API Key：

```bash
DASHSCOPE_API_KEY=sk-your-actual-api-key-here
DASHSCOPE_MODEL=deepseek-v3
```

### 2. 使用方式

#### 方式一：AI 自动生成提交信息（推荐）

```bash
bun run mygit
```

脚本会：
1. 检测所有文件变更
2. 调用 AI 生成简洁的中文提交信息
3. 自动执行 `git add .`
4. 自动执行 `git commit`
5. 自动执行 `git push`（如果分支没有上游，会自动设置）

#### 方式二：手动指定提交信息

```bash
bun run mygit "feat: 添加新功能"
```

或者直接运行脚本：

```bash
bun scripts/mygit.ts "fix: 修复登录问题"
```

## 工作流程

```
┌─────────────────┐
│  检测文件变更    │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 是否手动提供     │
│  提交信息？      │
└────┬───────┬────┘
     │ 是    │ 否
     │       ▼
     │  ┌─────────────────┐
     │  │ 调用 AI 生成     │
     │  │  提交信息        │
     │  └────────┬────────┘
     │           │
     │           ▼
     │  ┌─────────────────┐
     │  │ AI 生成成功？    │
     │  └────┬───────┬────┘
     │       │ 是    │ 否
     │       │       ▼
     │       │  ┌─────────────────┐
     │       │  │ 使用文件名生成   │
     │       │  │  兜底信息        │
     │       │  └────────┬────────┘
     │       │           │
     ▼       ▼           ▼
┌─────────────────────────┐
│  git add .              │
└────────┬────────────────┘
         │
         ▼
┌─────────────────────────┐
│  git commit -m "..."    │
└────────┬────────────────┘
         │
         ▼
┌─────────────────────────┐
│  git push               │
└────────┬────────────────┘
         │
         ▼
┌─────────────────────────┐
│ Push 成功？             │
└────┬───────────────┬────┘
     │ 是            │ 否
     │               ▼
     │      ┌─────────────────┐
     │      │ 是否缺少上游？   │
     │      └────┬───────┬────┘
     │           │ 是    │ 否
     │           ▼       ▼
     │      ┌─────────┐ ┌─────┐
     │      │ 设置上游│ │失败 │
     │      └────┬────┘ └─────┘
     │           │
     ▼           ▼
┌─────────────────────────┐
│  ✅ 完成                │
└─────────────────────────┘
```

## AI 提交信息示例

### 输入（Git Status）

```
M README.md
M package.json
A src/components/NewFeature.vue
D src/components/OldFeature.vue
?? docs/guide.md
```

### AI 生成的提交信息

```
更新文档和依赖，新增 NewFeature 组件
```

或

```
重构组件结构，添加使用指南
```

## 配置说明

### 环境变量

| 变量名 | 必需 | 默认值 | 说明 |
|--------|------|--------|------|
| `DASHSCOPE_API_KEY` | 是 | - | DashScope API 密钥 |
| `DASHSCOPE_BASE_URL` | 否 | `https://dashscope.aliyuncs.com/compatible-mode/v1` | API 基础 URL |
| `DASHSCOPE_MODEL` | 否 | `deepseek-v3` | 使用的 AI 模型 |

### 可用模型

- **deepseek-v3**（推荐）：性能强大，响应快速
- **qwen-vl-plus**：通义千问视觉增强版
- **deepseek-r1**：推理能力强
- **deepseek-v3.2-exp**：实验版本

## 常见问题

### Q1: 如何获取 DashScope API Key？

访问 [DashScope 控制台](https://dashscope.console.aliyun.com/)，注册并创建 API Key。

### Q2: AI 生成失败怎么办？

脚本会自动使用兜底机制，根据文件名生成提交信息，不会中断流程。

### Q3: 如何跳过 AI 生成？

直接提供提交信息参数：

```bash
bun run mygit "你的提交信息"
```

### Q4: 分支没有上游怎么办？

脚本会自动检测并设置上游分支：

```bash
git push --set-upstream origin <branch-name>
```

### Q5: 如何查看详细的 Git 输出？

脚本会在失败时自动显示详细的错误信息。

## 最佳实践

1. **配置 API Key**：首次使用前务必配置 `.env` 文件
2. **频繁提交**：小步快跑，每完成一个小功能就提交
3. **检查生成的信息**：AI 生成后会预览，确认无误再继续
4. **保持简洁**：AI 会生成简洁的提交信息，符合最佳实践
5. **特殊情况手动指定**：重要提交可以手动指定更详细的信息

## 与传统 Git 命令对比

### 传统方式

```bash
git status                    # 查看变更
git add .                     # 添加所有文件
git commit -m "提交信息"      # 提交
git push                      # 推送
# 如果失败，还要手动设置上游
git push --set-upstream origin branch-name
```

### 使用 mygit

```bash
bun run mygit
```

一条命令完成所有操作！

## 技术实现

- **运行时**：Bun（高性能 JavaScript 运行时）
- **AI 服务**：DashScope API（阿里云）
- **模型**：DeepSeek V3 / 通义千问
- **语言**：TypeScript

## 更新日志

### v1.0.0 (2026-02-06)

- ✨ 初始版本
- ✨ 支持 AI 自动生成提交信息
- ✨ 自动设置上游分支
- ✨ 兜底机制
- ✨ 完整的错误处理

## 许可证

MIT
